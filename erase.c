#include <stdio.h>
#include <string.h>
#include <stdint.h>
#include <unistd.h>
#include "bc_def.h"
#include "erase.h"

static uint16_t tmp107[107], readback_code[3798], readback_data[589], tmp80[80];

static bool (*readblock)(uint16_t, int, uint16_t *);
static bool (*readword)(uint16_t addr, uint16_t *data);
static bool (*writeblock)(uint16_t addr, int size, uint16_t buffer[]);
static bool (*writeword)(uint16_t addr, uint16_t data);
static bool (*isxapstopped)(void);

static int read16_1(int addr)
{
  uint16_t data;
  readword(addr, &data);
  return data;
}

static int read16(int addr, int cnt, uint16_t *buf)
{
  return readblock(addr, cnt, buf);
}

static int write16_1(int addr, int value)
{
  writeword(addr, value);
}

static int write16(int addr, int cnt, uint16_t *buf)
{
  return writeblock(addr, cnt, buf);
}

static bool wait_xap_stopped(void)
{
  while (!isxapstopped())
    usleep(1000);
  fprintf(stderr, "Stopped\n");
  return 1;
}

int erase(  bool (*_readblock)(uint16_t, int, uint16_t *),
            bool (*_read)(uint16_t addr, uint16_t *data),
            bool (*_writeblock)(uint16_t addr, int size, uint16_t buffer[]),
            bool (*_write)(uint16_t addr, uint16_t data),
            bool (*_IsXAPStopped)(void))
{
  readblock = _readblock;
  readword = _read;
  writeblock = _writeblock;
  writeword = _write;
  isxapstopped = _IsXAPStopped;
  memset(tmp107, 0, 107*sizeof(uint16_t));
  tmp107[106] = 2;
  
  /*0x4826*/ read16_1(0xff9a);
  /*0x4826*/ read16_1(0xff9a);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /*0x0000*/ read16_1(0xa000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /*0x0000*/ read16_1(0xa001);
  /**/ write16_1(0xa002, 0x00E0);
  /*0x00E0*/ read16_1(0xa002);
  /*0x0014*/ read16_1(0xffe9);
  /*0x0014*/ read16_1(0xffe9);
  /**/ write16_1(0xffe9, 0x0054);
  /*0x0054*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x0000);
  /*0x0000*/ read16_1(0xffea);
  /*0x0018*/ read16_1(0xff7e);
  /*0x0018*/ read16_1(0xff7e);
  /**/ write16_1(0xff7e, 0x0018);
  /*0x0018*/ read16_1(0xff7e);
  /**/ write16_1(0xffde, 0x0000);
  /*0x0000*/ read16_1(0xffde);
  /*0x0052*/ read16_1(0xffe8);
  /*0x0052*/ read16_1(0xffe8);
  /**/ write16_1(0xffe8, 0x0000);
  /*0x0000*/ read16_1(0xffe8);
  /**/ write16_1(0x0076, 0x0002);
  /*0x0002*/ read16_1(0x0076);
  /**/ write16_1(0xff91, 0x0005);
  /**/ write16_1(0x0077, 0x0001);
  /*0x0001*/ read16_1(0x0077);
  /**/ write16_1(0x006a, 0x0000);
  /*0x0000*/ read16_1(0x006a);
  /*0x0001*/ read16_1(0xff91);
  /*0x8000*/ read16_1(0xff91);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  write16(0x0000, 107, tmp107);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /*0x00FF*/ read16_1(0xffeb);
  /*0x00FF*/ read16_1(0xffeb);
  /*0xFFFF*/ read16_1(0xffec);
  /*0xFFFF*/ read16_1(0xffec);
  write16(0xffe06, 16, tmp107);
  /**/ write16_1(0xffeb, 0x00FF);
  /*0x00FF*/ read16_1(0xffeb);
  /**/ write16_1(0xffec, 0xFFFF);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16_1(0xf9c0, 0x0009);
  /**/ write16_1(0xf9c0, 0x0009);
  /**/ write16_1(0xf9c0, 0x0000);
  /**/ write16_1(0xf9c0, 0x0000);
  /**/ write16_1(0xf9c0, 0x0000);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /*0x0000*/ read16_1(0xa000);
  /**/ write16_1(0xa001, 0x0000);
  /*0x0000*/ read16_1(0xa001);
  /**/ write16_1(0xa002, 0x00E0);
  /*0x00E0*/ read16_1(0xa002);
  /*0x0000*/ read16_1(0xffe9);
  /*0x0000*/ read16_1(0xffe9);
  /**/ write16_1(0xffe9, 0x0054);
  /*0x0054*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x0000);
  /*0x0000*/ read16_1(0xffea);
  /*0x0000*/ read16_1(0xff7e);
  /*0000 read16_1(0xff7e)
    /**/ write16_1(0xff7e, 0x0000);
  /*0x0000*/ read16_1(0xff7e);
  /**/ write16_1(0xffde, 0x0000);
  /*0x0000*/ read16_1(0xffde);
  /*0x0000*/ read16_1(0xffe8);
  /*0x0000*/ read16_1(0xffe8);
  /**/ write16_1(0xffe8, 0x0000);
  /*0x0000*/ read16_1(0xffe8);
  /**/ write16_1(0x0076, 0x0002);
  /*0x0002*/ read16_1(0x0076);
  /**/ write16_1(0xff91, 0x0005);
  /**/ write16_1(0x0077, 0x0001);
  /*0x0001*/ read16_1(0x0077);
  /**/ write16_1(0x006a, 0x0000);
  /*0x0000*/ read16_1(0x006a);
  /*0xFFFF*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16(0x0000, 107, tmp107);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /*0x00FF*/ read16_1(0xffeb);
  /*0x00FF*/ read16_1(0xffeb);
  /*0xFFFF*/ read16_1(0xffec);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16(0xffe0, 16, tmp107);
  /**/ write16_1(0xffeb, 0x00FF);
  /*0x00FF*/ read16_1(0xffeb);
  /**/ write16_1(0xffec, 0xFFFF);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16_1(0xff52, 0x0000);
  /*0x0000*/ read16_1(0xff52);
  /*0x00AA*/ write16(0xc400, 589, boot_prog_data);
  /*0x00AA*/ read16(0xc400, 589, readback_data);
  /*0x0410*/ write16(0xc670, 3798, boot_prog_code);
  /*0x0410*/ read16(0xc670, 3798, readback_code);
  /**/ write16_1(0xc670, 0x6F10);
  /*0x6F10*/ read16_1(0xc670);
  /**/ write16_1(0xc672, 0x0E10);
  /*0x0E10*/ read16_1(0xc672);
  /**/ write16_1(0xffe9, 0x0014);
  /*0x0014*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x2670);
  /*0x2670*/ read16_1(0xffea);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0001);
  wait_xap_stopped();
  read16_1(0xc000);
  /*0x0000*/ read16_1(0xc000);
  /**/ write16_1(0xc003, 0x0000);
  /**/ write16_1(0xc000, 0x0001);
  /*0x0001*/ read16_1(0xc000);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0001);
  wait_xap_stopped();
  read16_1(0xc000);
  /*0x0000*/ read16_1(0xc000);
  /*0x0014*/ read16_1(0xc00d);
  /*0x0014*/ read16_1(0xc00d);
  /*0x0080*/ read16_1(0xc010);
  /*0x0080*/ read16_1(0xc010);
  /*0x0001*/ read16_1(0xc001);
  /*0x0001*/ read16_1(0xc001);
  /*0x0001*/ read16_1(0xa000);
  /*0x0001*/ read16_1(0xa000);
  /*0x225B*/ read16_1(0xa001);
  /*0x225B*/ read16_1(0xa001);
  /*0x1000*/ read16_1(0xc006);
  /*0x1000*/ read16_1(0xc006);
  /*0x0080*/ read16_1(0xc002);
  /*0x0080*/ read16_1(0xc002);
  /*0x0001*/ read16(0xa000, 80, tmp80);
  /*0x0001*/ read16(0xa000, 80, tmp80);
  /*0x4826*/ read16_1(0xff9a);
  /*0x4826*/ read16_1(0xff9a);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /*0x0000*/ read16_1(0xa000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /**/ write16_1(0xa001, 0x0000);
  /*0x0000*/ read16_1(0xa001);
  /**/ write16_1(0xa002, 0x00E0);
  /*0x00E0*/ read16_1(0xa002);
  /*0x0014*/ read16_1(0xffe9);
  /*0x0014*/ read16_1(0xffe9);
  /**/ write16_1(0xffe9, 0x0054);
  /*0x0054*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x0000);
  /*0x0000*/ read16_1(0xffea);
  /*0x0000*/ read16_1(0xff7e);
  /*0x0000*/ read16_1(0xff7e);
  /**/ write16_1(0xff7e, 0x0000);
  /*0x0000*/ read16_1(0xff7e);
  /**/ write16_1(0xffde, 0x0000);
  /*0x0000*/ read16_1(0xffde);
  /*0x0015*/ read16_1(0xffe8);
  /*0x0015*/ read16_1(0xffe8);
  /**/ write16_1(0xffe8, 0x0000);
  /*0x0000*/ read16_1(0xffe8);
  /**/ write16_1(0x0076, 0x0002);
  /*0x0002*/ read16_1(0x0076);
  /**/ write16_1(0xff91, 0x0005);
  /**/ write16_1(0x0077, 0x0001);
  /*0x0001*/ read16_1(0x0077);
  /**/ write16_1(0x006a, 0x0000);
  /*0x0000*/ read16_1(0x006a);
  /*0x0001*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16(0x0000, 107, tmp107);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /*0x00FF*/ read16_1(0xffeb);
  /*0x00FF*/ read16_1(0xffeb);
  /*0xFFFF*/ read16_1(0xffec);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16(0xffe0, 16, tmp107);
  /**/ write16_1(0xffeb, 0x00FF);
  /*0x00FF*/ read16_1(0xffeb);
  /**/ write16_1(0xffec, 0xFFFF);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16_1(0xff52, 0x0000);
  /*0x0000*/ read16_1(0xff52);
  /*0x00AA*/ write16(0xc400, 589, boot_prog_data);
  /*0x00AA*/ read16(0xc400, 589, readback_data);
  /*0x0410*/ write16(0xc670, 3798, boot_prog_code);
  /*0x0410*/ read16(0xc670, 3798, readback_code);
  /**/ write16_1(0xc670, 0x6F10);
  /*0x6F10*/ read16_1(0xc670);
  /**/ write16_1(0xc672, 0x0E10);
  /*0x0E10*/ read16_1(0xc672);
  /**/ write16_1(0xffe9, 0x0014);
  /*0x0014*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x2670);
  /*0x2670*/ read16_1(0xffea);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0001);
  wait_xap_stopped();
  read16_1(0xc000);
  /*0x0000*/ read16_1(0xc000);
  /**/ write16_1(0xc003, 0x0000);
  /**/ write16_1(0xc000, 0x0001);
  /*0x0001*/ read16_1(0xc000);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0001);
  /* Running, Stopped 0000*/
  read16_1(0xc000);
  /*0x0000*/ read16_1(0xc000);
  /*0x0014*/ read16_1(0xc00d);
  /*0x0014*/ read16_1(0xc00d);
  /*0x0080*/ read16_1(0xc010);
  /*0x0080*/ read16_1(0xc010);
  /*0x0001*/ read16_1(0xc001);
  /*0x0001*/ read16_1(0xc001);
  /*0x0001*/ read16_1(0xa000);
  /*0x0001*/ read16_1(0xa000);
  /*0x225B*/ read16_1(0xa001);
  /*0x225B*/ read16_1(0xa001);
  /*0x1000*/ read16_1(0xc006);
  /*0x1000*/ read16_1(0xc006);
  /*0x0080*/ read16_1(0xc002);
  /*0x0080*/ read16_1(0xc002);
  /*0x0001*/ read16(0xa000, 80, tmp80);
  /*0x0001*/ read16(0xa000, 80, tmp80);
  /*0x4826*/ read16_1(0xff9a);
  /*0x4826*/ read16_1(0xff9a);
  /**/ write16_1(0xc000, 0x0009);
  /*0x0009*/ read16_1(0xc000);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0001);
  wait_xap_stopped();
  read16_1(0xc000);
  /*0x0000*/ read16_1(0xc000);
  /*0x0000*/ read16_1(0xc00a);
  /*0x0000*/ read16_1(0xc00a);
  /*0x0000*/ read16_1(0xc00b);
  /*0x0000*/ read16_1(0xc00b);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0x006a, 0x0003);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /**/ write16_1(0xa000, 0x0000);
  /*0x0000*/ read16_1(0xa000);
  /**/ write16_1(0xa001, 0x0000);
  /*0x0000*/ read16_1(0xa001);
  /**/ write16_1(0xa002, 0x00E0);
  /*0x00E0*/ read16_1(0xa002);
  /*0x0014*/ read16_1(0xffe9);
  /*0x0014*/ read16_1(0xffe9);
  /**/ write16_1(0xffe9, 0x0054);
  /*0x0054*/ read16_1(0xffe9);
  /**/ write16_1(0xffea, 0x0000);
  /*0x0000*/ read16_1(0xffea);
  /*0x0000*/ read16_1(0xff7e);
  /*0x0000*/ read16_1(0xff7e);
  /**/ write16_1(0xff7e, 0x0000);
  /*0x0000*/ read16_1(0xff7e);
  /**/ write16_1(0xffde, 0x0000);
  /*0x0000*/ read16_1(0xffde);
  /*0x0015*/ read16_1(0xffe8);
  /*0x0015*/ read16_1(0xffe8);
  /**/ write16_1(0xffe8, 0x0000);
  /*0x0000*/ read16_1(0xffe8);
  /**/ write16_1(0x0076, 0x0002);
  /*0x0002*/ read16_1(0x0076);
  /**/ write16_1(0xff91, 0x0005);
  /**/ write16_1(0x0077, 0x0001);
  /*0x0001*/ read16_1(0x0077);
  /**/ write16_1(0x006a, 0x0000);
  /*0x0000*/ read16_1(0x006a);
  /*0x0001*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /*0x0000*/ read16_1(0xff91);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16(0x0000, 107, tmp107);
  /**/ write16_1(0x006a, 0x0002);
  /**/ write16_1(0x006a, 0x0002);
  /*0x00FF*/ read16_1(0xffeb);
  /*0x00FF*/ read16_1(0xffeb);
  /*0xFFFF*/ read16_1(0xffec);
  /*0xFFFF*/ read16_1(0xffec);
  /**/ write16(0xffe0, 16, tmp107);
  /**/ write16_1(0xffeb, 0x00FF);
  /*0x00FF*/ read16_1(0xffeb);
  /**/ write16_1(0xffec, 0xFFFF);
  /*0xFFFF*/ read16_1(0xffec);
}
